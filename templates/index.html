<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sensor History</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      #chart-container { max-width: 900px; }
    </style>
  </head>
  <body>
    <h1>Temperature History</h1>
    <div id="chart-container">
      <canvas id="historyChart"></canvas>
    </div>
    <p>
      <button id="refresh">Refresh</button>
    </p>

    <script>
      const ctx = document.getElementById('historyChart').getContext('2d');
      let chart = new Chart(ctx, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Temperature (Â°C)', data: [], borderColor: 'blue', fill: false }] },
        options: { scales: { x: { display: true }, y: { beginAtZero: false } } }
      });

      async function loadData() {
        const res = await fetch('/api/readings');
        const rows = await res.json();
        const labels = rows.map(r => new Date(r.timestamp).toLocaleString());
        const data = rows.map(r => r.value);
        chart.data.labels = labels;
        chart.data.datasets[0].data = data;
        chart.update();
      }

      document.getElementById('refresh').addEventListener('click', loadData);
      // initial load
      loadData();
    </script>
  </body>
</html>
